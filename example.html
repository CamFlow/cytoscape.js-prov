<!DOCTYPE>

<html>

	<head>
		<title>JSProvViewer demo</title>

		<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1">

		<script src="http://code.jquery.com/jquery-2.0.3.min.js"></script>
		<script src="http://cytoscape.github.io/cytoscape.js/api/cytoscape.js-latest/cytoscape.min.js"></script>

		<!-- for testing with local version of cytoscape.js -->
		<!--<script src="../cytoscape.js/build/cytoscape.js"></script>-->

		<script src="https://cdn.rawgit.com/cpettitt/dagre/v0.7.4/dist/dagre.min.js"></script>
		<script src="https://cdn.rawgit.com/cytoscape/cytoscape.js-dagre/1.1.2/cytoscape-dagre.js"></script>
		<script src="https://cdn.rawgit.com/cytoscape/cytoscape.js-cose-bilkent/1.0.2/cytoscape-cose-bilkent.js"></script>
		<script src="https://cdn.rawgit.com/cytoscape/cytoscape.js-spread/1.0.9/cytoscape-spread.js"></script>
		<script src="https://api.cloudmqtt.com/sso/js/mqttws31.js"></script>
		<script src="./js/cytoscape-prov-core.js"></script>
		<script src="./js/cytoscape-prov-json.js"></script>
		<script src="./js/JSProvView-mqtt.js"></script>
		<script>
		$(function(){
			var cy = window.cy = cytoscape({
				container: document.getElementById('cy'),

				boxSelectionEnabled: false,

				layout: {
					name: 'dagre',
					rankDir: 'TB'
				},

				style: [
					{
						selector: 'node',
						style: {
							'content': 'data(label)',
							'text-opacity': 0.5,
							'text-valign': 'center',
							'text-halign': 'right',
							'background-color': 'data(color)',
							'shape': 'data(shape)'
						}
					},

					{
						selector: 'edge',
						style: {
							'label': 'data(label)',
							'edge-text-rotation': 'autorotate',
							'text-wrap': 'wrap',
							'width': 3,
							'length': 100,
							'source-arrow-shape': 'triangle',
							'line-color': 'data(color)',
							'source-arrow-color': 'data(color)',
							'curve-style': 'bezier',
							'control-point-step-size': 40,
							'font-size': 6,
							'text-outline-color': '#FFFFFF',
							'text-outline-width': 1,
						}
					},
					{
					  selector: ':parent',
					  style: {
						'background-opacity': 0.333
					  }
					},
					{
						selector: ':selected',
						style: {
							'border-width': 3,
							'border-color': '#333'
						}
					},
					{
						selector: '.faded',
						style: {
							'opacity': 0.25
						}
					}
					,
					{
						selector: 'node.prov_successor',
						style: {
							'border-width': 3,
							'border-color': 'blue'
						}
					}
					,
					{
						selector: 'node.prov_ancestor',
						style: {
							'border-width': 3,
							'border-color': 'red'
						}
					}
				]
			});
		});
		</script>

		<style>
			#cy {
				width: 800px;
				height: 600px;
				position: absolute;
				left: 430;
				top: 0;
				z-index: 999;
			}
		</style>
	</head>

	<body>
		<div>
		<div>
		<textarea rows="20" cols="50" id="area"></textarea>
		</div>
		<input type="file" id="fileinput" />
		<script type="text/javascript">
		  function readSingleFile(evt) {
			//Retrieve the first (and only!) File from the FileList object
			var f = evt.target.files[0];

			if (f) {
			  var r = new FileReader();
			  r.onload = function(e) {
				var contents = e.target.result;
				document.getElementById('area').value=  contents;
				JSProvParseJSON(contents);
			  }
			  r.readAsText(f);
			} else {
			  alert("Failed to load file");
			}
		  }

		  document.getElementById('fileinput').addEventListener('change', readSingleFile, false);
		</script>
		</div>

		<script type="text/javascript">
		  function changeGraphType() {
			switch(JSProvGetGraphType()){
				case 'dagre':
					JSProvSetGraphType('breadthfirst');
					break;
				case 'breadthfirst':
					JSProvSetGraphType('circle');
					break;
				case 'circle':
					JSProvSetGraphType('concentric');
					break;
				case 'concentric':
					JSProvSetGraphType('cose');
					break;
				case 'cose':
					JSProvSetGraphType('cose-bilkent');
					break;
				case 'cose-bilkent':
					JSProvSetGraphType('grid');
					break;
				case 'grid':
					JSProvSetGraphType('spread');
					break;
				case 'spread':
					JSProvSetGraphType('dagre');
					break;
				default:
					JSProvSetGraphType('dagre');
			}
			document.getElementById("graph_type").innerHTML=JSProvGetGraphType();
			JSProvDraw();
		  }
		</script>
		<div>
		<button type="button" onclick="changeGraphType();">Change</button>
		<span>Graph type:
		<span id="graph_type">dagre</span>
		</span>
		</div>
		<script>
			function showAncestor(){
				var show = document.getElementById("ancestors").checked;
				JSProvSetShowAncestors(show);
			}
			function showSuccessor(){
				var show = document.getElementById("successors").checked;
				JSProvSetShowSuccessors(show);
			}
			function ignoreControl(){
				var ignore = document.getElementById("control").checked;
				JSProvSetIgnoreControlFlow(ignore);
			}
		</script>
		<div>
		  <input type="checkbox" id="ancestors" name="ancestors" value="ancestors" onclick="showAncestor();"checked>Show Ancestor<br>
		  <input type="checkbox" id="successors" name="successors" value="successors" onclick="showSuccessor();" checked>Show Successor<br>
		  <input type="checkbox" id="control" name="control" value="control" onclick="ignoreControl();">Ignore Control Flow
		</div>
		<div>
		<button type="button" onclick="JSProvMQTTConnect();">Start CamFlow MQTT</button><span id="mqtt"></span>
		</div>
		<textarea rows="5" cols="50" id="camflow-message"></textarea>
		<div id="cy"></div>
	</body>

</html>
